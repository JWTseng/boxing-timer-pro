<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>主应用颜色诊断</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: white;
            padding: 20px;
        }
        .diagnostic {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .color-box {
            display: inline-block;
            width: 50px;
            height: 30px;
            margin: 5px;
            border: 1px solid #fff;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>🔍 主应用颜色诊断工具</h1>
    
    <div class="diagnostic">
        <h3>检测主应用页面 (iframe)</h3>
        <iframe src="/" width="100%" height="300" style="border: 1px solid #ccc;"></iframe>
    </div>
    
    <div class="diagnostic">
        <h3>CSS变量值实时读取</h3>
        <div id="css-vars-main"></div>
    </div>
    
    <div class="diagnostic">
        <h3>time-tag按钮计算后样式</h3>
        <div id="computed-styles"></div>
    </div>
    
    <button onclick="diagnoseColors()" style="background: #007AFF; color: white; border: none; padding: 10px 20px; border-radius: 6px; margin: 10px;">
        🚀 开始诊断
    </button>
    
    <script>
        function diagnoseColors() {
            const iframe = document.querySelector('iframe');
            
            // 等待iframe加载完成
            iframe.onload = function() {
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    const iframeWindow = iframe.contentWindow;
                    
                    // 读取CSS变量值
                    const cssVarsDiv = document.getElementById('css-vars-main');
                    const computedDiv = document.getElementById('computed-styles');
                    
                    const phases = ['prepare', 'round', 'warning', 'rest'];
                    let cssVarsHTML = '<h4>主应用CSS变量值:</h4>';
                    let computedHTML = '<h4>主应用按钮实际样式:</h4>';
                    
                    phases.forEach(phase => {
                        // 获取CSS变量值
                        const cssVar = iframeWindow.getComputedStyle(iframeDoc.documentElement).getPropertyValue(`--color-${phase}`).trim();
                        cssVarsHTML += `<div>--color-${phase}: <strong>${cssVar}</strong> <div class="color-box" style="background: ${cssVar};"></div></div>`;
                        
                        // 获取按钮实际样式
                        const button = iframeDoc.getElementById(`${phase}-time`);
                        if (button) {
                            const computed = iframeWindow.getComputedStyle(button);
                            const bg = computed.backgroundColor;
                            const color = computed.color;
                            computedHTML += `<div>${phase}-time按钮: 背景=${bg}, 文字=${color} <div class="color-box" style="background: ${bg};"></div></div>`;
                        } else {
                            computedHTML += `<div>${phase}-time按钮: 未找到</div>`;
                        }
                    });
                    
                    cssVarsDiv.innerHTML = cssVarsHTML;
                    computedDiv.innerHTML = computedHTML;
                    
                    // 检查是否有特殊模式启用
                    const bodyClasses = iframeDoc.body.className;
                    if (bodyClasses) {
                        cssVarsDiv.innerHTML += `<div><strong>Body classes:</strong> ${bodyClasses}</div>`;
                    }
                    
                } catch (error) {
                    document.getElementById('css-vars-main').innerHTML = `<div style="color: red;">错误: ${error.message}</div>`;
                }
            };
            
            // 强制重新加载iframe
            iframe.src = iframe.src;
        }
        
        // 页面加载时自动诊断
        setTimeout(diagnoseColors, 1000);
    </script>
</body>
</html>
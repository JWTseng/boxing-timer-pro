<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STARTé¡µé¢æµç¨‹éªŒæ”¶æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #1C1C1E;
            color: white;
            padding: 20px;
            line-height: 1.6;
        }
        .test-container {
            max-width: 900px;
            margin: 0 auto;
        }
        .test-section {
            background: #2C2C2E;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #30D158;
        }
        .test-item {
            background: #3C3C3E;
            padding: 16px;
            border-radius: 8px;
            margin: 12px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .status-pending { border-left: 4px solid #8E8E93; }
        .status-testing { border-left: 4px solid #FFD60A; }
        .status-passed { border-left: 4px solid #30D158; }
        .status-failed { border-left: 4px solid #FF453A; }
        .test-button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        .test-button:hover {
            background: #0056CC;
        }
        .test-button.run-all {
            background: #FF9500;
            padding: 12px 24px;
            font-size: 16px;
            margin: 10px;
        }
        .result {
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        .result.pass { background: #30D158; color: #000; }
        .result.fail { background: #FF453A; color: #FFF; }
        .result.pending { background: #8E8E93; color: #FFF; }
        .flow-diagram {
            background: #000;
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª STARTé¡µé¢æµç¨‹éªŒæ”¶æµ‹è¯•</h1>
        <p><strong>@TestAI</strong> æ‰§è¡Œå®Œæ•´çš„åŠŸèƒ½éªŒæ”¶æµ‹è¯•</p>
        
        <button class="test-button run-all" onclick="runAllTests()">ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        
        <div class="test-section">
            <h2>ğŸ“‹ æµ‹è¯•æµç¨‹è§„èŒƒ</h2>
            <div class="flow-diagram">
åº”ç”¨å¯åŠ¨ â†’ æ˜¾ç¤ºè®¾ç½®é¡µé¢ï¼ˆé»˜è®¤çŠ¶æ€ï¼‰
    â†“ 
ç‚¹å‡»STARTæŒ‰é’® â†’ éšè—è®¾ç½®é¡µé¢ + æ˜¾ç¤ºè¿è¡Œé¡µé¢ + å¼€å§‹è®¡æ—¶
    â†“
è¿è¡Œè®¡æ—¶å™¨ â†’ é˜¶æ®µåˆ‡æ¢ï¼ˆPREPARE â†’ ROUND â†’ WARNING â†’ RESTï¼‰  
    â†“
ç‚¹å‡»XæŒ‰é’® â†’ åœæ­¢è®¡æ—¶ + éšè—è¿è¡Œé¡µé¢ + æ˜¾ç¤ºè®¾ç½®é¡µé¢
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ” æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•</h2>
            
            <div class="test-item status-pending" id="test-1">
                <span>æµ‹è¯•1: åº”ç”¨åˆå§‹çŠ¶æ€ - è®¾ç½®é¡µé¢æ˜¾ç¤ºï¼Œè¿è¡Œé¡µé¢éšè—</span>
                <div>
                    <span class="result pending" id="result-1">å¾…æµ‹è¯•</span>
                    <button class="test-button" onclick="testInitialState()">æµ‹è¯•</button>
                </div>
            </div>
            
            <div class="test-item status-pending" id="test-2">
                <span>æµ‹è¯•2: STARTæŒ‰é’®ç‚¹å‡» - æ­£ç¡®åˆ‡æ¢åˆ°è¿è¡Œç•Œé¢</span>
                <div>
                    <span class="result pending" id="result-2">å¾…æµ‹è¯•</span>
                    <button class="test-button" onclick="testStartButton()">æµ‹è¯•</button>
                </div>
            </div>
            
            <div class="test-item status-pending" id="test-3">
                <span>æµ‹è¯•3: è¿è¡Œç•Œé¢UI - æ—¶é’Ÿã€é˜¶æ®µå¡ç‰‡ã€æ§åˆ¶æŒ‰é’®æ­£ç¡®æ˜¾ç¤º</span>
                <div>
                    <span class="result pending" id="result-3">å¾…æµ‹è¯•</span>
                    <button class="test-button" onclick="testRunningUI()">æµ‹è¯•</button>
                </div>
            </div>
            
            <div class="test-item status-pending" id="test-4">
                <span>æµ‹è¯•4: é˜¶æ®µèƒŒæ™¯è‰² - 4ä¸ªé˜¶æ®µé¢œè‰²æ­£ç¡®åˆ‡æ¢</span>
                <div>
                    <span class="result pending" id="result-4">å¾…æµ‹è¯•</span>
                    <button class="test-button" onclick="testPhaseColors()">æµ‹è¯•</button>
                </div>
            </div>
            
            <div class="test-item status-pending" id="test-5">
                <span>æµ‹è¯•5: XæŒ‰é’®åŠŸèƒ½ - æ­£ç¡®å…³é—­è¿è¡Œé¡µé¢ï¼Œè¿”å›è®¾ç½®é¡µé¢</span>
                <div>
                    <span class="result pending" id="result-5">å¾…æµ‹è¯•</span>
                    <button class="test-button" onclick="testStopButton()">æµ‹è¯•</button>
                </div>
            </div>
            
            <div class="test-item status-pending" id="test-6">
                <span>æµ‹è¯•6: å®Œæ•´æµç¨‹ - START â†’ è¿è¡Œ â†’ å…³é—­ â†’ è®¾ç½®</span>
                <div>
                    <span class="result pending" id="result-6">å¾…æµ‹è¯•</span>
                    <button class="test-button" onclick="testCompleteFlow()">æµ‹è¯•</button>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š æµ‹è¯•ç»“æœæ€»è§ˆ</h2>
            <div id="test-summary">
                <p>ç­‰å¾…æµ‹è¯•æ‰§è¡Œ...</p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ› ï¸ æ‰‹åŠ¨éªŒè¯å·¥å…·</h2>
            <button class="test-button" onclick="openMainApp()">æ‰“å¼€ä¸»åº”ç”¨</button>
            <button class="test-button" onclick="resetApp()">é‡ç½®åº”ç”¨çŠ¶æ€</button>
            <button class="test-button" onclick="checkConsoleErrors()">æ£€æŸ¥æ§åˆ¶å°é”™è¯¯</button>
        </div>
    </div>

    <script>
        let testResults = {
            test1: 'pending',
            test2: 'pending', 
            test3: 'pending',
            test4: 'pending',
            test5: 'pending',
            test6: 'pending'
        };
        
        function updateTestResult(testId, result, message = '') {
            testResults[testId] = result;
            const resultElement = document.getElementById(`result-${testId.slice(-1)}`);
            const testElement = document.getElementById(`test-${testId.slice(-1)}`);
            
            if (resultElement && testElement) {
                resultElement.textContent = result === 'pass' ? 'âœ… é€šè¿‡' : 
                                          result === 'fail' ? 'âŒ å¤±è´¥' : 'â³ æµ‹è¯•ä¸­';
                resultElement.className = `result ${result}`;
                
                testElement.className = `test-item status-${result === 'pass' ? 'passed' : 
                                                         result === 'fail' ? 'failed' : 'testing'}`;
            }
            
            updateSummary();
            console.log(`æµ‹è¯• ${testId}: ${result} - ${message}`);
        }
        
        function updateSummary() {
            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(r => r === 'pass').length;
            const failed = Object.values(testResults).filter(r => r === 'fail').length;
            const pending = total - passed - failed;
            
            const summary = document.getElementById('test-summary');
            summary.innerHTML = \`
                <p><strong>æµ‹è¯•è¿›åº¦:</strong> \${passed + failed}/\${total} å®Œæˆ</p>
                <p>âœ… é€šè¿‡: \${passed} | âŒ å¤±è´¥: \${failed} | â³ å¾…æµ‹è¯•: \${pending}</p>
                <p><strong>é€šè¿‡ç‡:</strong> \${total > 0 ? Math.round(passed / total * 100) : 0}%</p>
            \`;
        }
        
        // æµ‹è¯•1: åº”ç”¨åˆå§‹çŠ¶æ€
        async function testInitialState() {
            updateTestResult('test1', 'testing');
            
            try {
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const mainWindow = window.parent || window;
                const setupView = mainWindow.document.getElementById('timer-setup-view');
                const runningView = mainWindow.document.getElementById('timer-running-view');
                
                if (!setupView || !runningView) {
                    updateTestResult('test1', 'fail', 'ç•Œé¢å…ƒç´ æœªæ‰¾åˆ°');
                    return;
                }
                
                const setupVisible = setupView.style.display !== 'none';
                const runningHidden = runningView.style.display === 'none';
                
                if (setupVisible && runningHidden) {
                    updateTestResult('test1', 'pass', 'åˆå§‹çŠ¶æ€æ­£ç¡®');
                } else {
                    updateTestResult('test1', 'fail', \`è®¾ç½®é¡µé¢: \${setupVisible}, è¿è¡Œé¡µé¢éšè—: \${runningHidden}\`);
                }
                
            } catch (error) {
                updateTestResult('test1', 'fail', error.message);
            }
        }
        
        // æµ‹è¯•2: STARTæŒ‰é’®ç‚¹å‡»
        async function testStartButton() {
            updateTestResult('test2', 'testing');
            
            try {
                const mainWindow = window.parent || window;
                const startBtn = mainWindow.document.getElementById('start-btn');
                
                if (!startBtn) {
                    updateTestResult('test2', 'fail', 'STARTæŒ‰é’®æœªæ‰¾åˆ°');
                    return;
                }
                
                // ç¡®ä¿åˆå§‹çŠ¶æ€
                await testInitialState();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // ç‚¹å‡»STARTæŒ‰é’®
                startBtn.click();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ£€æŸ¥åˆ‡æ¢ç»“æœ
                const setupView = mainWindow.document.getElementById('timer-setup-view');
                const runningView = mainWindow.document.getElementById('timer-running-view');
                
                const setupHidden = setupView.style.display === 'none';
                const runningVisible = runningView.style.display === 'flex';
                
                if (setupHidden && runningVisible) {
                    updateTestResult('test2', 'pass', 'STARTæŒ‰é’®æ­£ç¡®åˆ‡æ¢ç•Œé¢');
                } else {
                    updateTestResult('test2', 'fail', \`è®¾ç½®é¡µé¢éšè—: \${setupHidden}, è¿è¡Œé¡µé¢æ˜¾ç¤º: \${runningVisible}\`);
                }
                
            } catch (error) {
                updateTestResult('test2', 'fail', error.message);
            }
        }
        
        // æµ‹è¯•3: è¿è¡Œç•Œé¢UI
        async function testRunningUI() {
            updateTestResult('test3', 'testing');
            
            try {
                const mainWindow = window.parent || window;
                
                // ç¡®ä¿è¿è¡Œç•Œé¢æ˜¾ç¤º
                await testStartButton();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // æ£€æŸ¥UIå…ƒç´ 
                const mainTimer = mainWindow.document.getElementById('main-timer');
                const phaseInfo = mainWindow.document.getElementById('phase-info');
                const roundNumber = mainWindow.document.getElementById('round-number');
                const pauseBtn = mainWindow.document.getElementById('pause-btn');
                const stopBtn = mainWindow.document.getElementById('stop-btn');
                
                const elements = { mainTimer, phaseInfo, roundNumber, pauseBtn, stopBtn };
                const missing = Object.keys(elements).filter(key => !elements[key]);
                
                if (missing.length === 0) {
                    updateTestResult('test3', 'pass', 'æ‰€æœ‰UIå…ƒç´ æ­£ç¡®æ˜¾ç¤º');
                } else {
                    updateTestResult('test3', 'fail', \`ç¼ºå¤±å…ƒç´ : \${missing.join(', ')}\`);
                }
                
            } catch (error) {
                updateTestResult('test3', 'fail', error.message);
            }
        }
        
        // æµ‹è¯•4: é˜¶æ®µèƒŒæ™¯è‰²
        async function testPhaseColors() {
            updateTestResult('test4', 'testing');
            
            try {
                const mainWindow = window.parent || window;
                
                // ç¡®ä¿è¿è¡Œç•Œé¢æ˜¾ç¤º
                await testStartButton();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const runningView = mainWindow.document.getElementById('timer-running-view');
                const phases = ['prepare', 'round', 'warning', 'rest'];
                const expectedColors = {
                    'prepare': '#FFD60A',
                    'round': '#8BC34A', 
                    'warning': '#FF9500',
                    'rest': '#FF6B47'
                };
                
                let allColorsCorrect = true;
                
                for (const phase of phases) {
                    runningView.className = \`view timer-running phase-\${phase}\`;
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    const computedStyle = mainWindow.getComputedStyle(runningView);
                    const bgColor = computedStyle.backgroundColor;
                    
                    // ç®€åŒ–çš„é¢œè‰²æ£€æŸ¥ï¼ˆç”±äºRGBè½¬æ¢å¤æ‚ï¼‰
                    if (!bgColor || bgColor === 'rgba(0, 0, 0, 0)' || bgColor === 'transparent') {
                        allColorsCorrect = false;
                        break;
                    }
                }
                
                if (allColorsCorrect) {
                    updateTestResult('test4', 'pass', 'æ‰€æœ‰é˜¶æ®µèƒŒæ™¯è‰²æ­£ç¡®');
                } else {
                    updateTestResult('test4', 'fail', 'éƒ¨åˆ†é˜¶æ®µèƒŒæ™¯è‰²ä¸æ­£ç¡®');
                }
                
            } catch (error) {
                updateTestResult('test4', 'fail', error.message);
            }
        }
        
        // æµ‹è¯•5: XæŒ‰é’®åŠŸèƒ½
        async function testStopButton() {
            updateTestResult('test5', 'testing');
            
            try {
                const mainWindow = window.parent || window;
                
                // ç¡®ä¿è¿è¡Œç•Œé¢æ˜¾ç¤º
                await testStartButton();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // ç‚¹å‡»XæŒ‰é’®
                const stopBtn = mainWindow.document.getElementById('stop-btn');
                if (!stopBtn) {
                    updateTestResult('test5', 'fail', 'XæŒ‰é’®æœªæ‰¾åˆ°');
                    return;
                }
                
                stopBtn.click();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ£€æŸ¥æ˜¯å¦è¿”å›è®¾ç½®é¡µé¢
                const setupView = mainWindow.document.getElementById('timer-setup-view');
                const runningView = mainWindow.document.getElementById('timer-running-view');
                
                const setupVisible = setupView.style.display !== 'none';
                const runningHidden = runningView.style.display === 'none';
                
                if (setupVisible && runningHidden) {
                    updateTestResult('test5', 'pass', 'XæŒ‰é’®æ­£ç¡®å…³é—­è¿è¡Œé¡µé¢');
                } else {
                    updateTestResult('test5', 'fail', \`è®¾ç½®é¡µé¢æ˜¾ç¤º: \${setupVisible}, è¿è¡Œé¡µé¢éšè—: \${runningHidden}\`);
                }
                
            } catch (error) {
                updateTestResult('test5', 'fail', error.message);
            }
        }
        
        // æµ‹è¯•6: å®Œæ•´æµç¨‹
        async function testCompleteFlow() {
            updateTestResult('test6', 'testing');
            
            try {
                console.log('å¼€å§‹å®Œæ•´æµç¨‹æµ‹è¯•...');
                
                // é‡ç½®åˆ°åˆå§‹çŠ¶æ€
                await resetApp();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // æ‰§è¡Œå®Œæ•´æµç¨‹
                await testInitialState();
                await testStartButton();
                await testRunningUI();
                await testStopButton();
                
                // æ£€æŸ¥æœ€ç»ˆçŠ¶æ€
                const finalResult = testResults.test1 === 'pass' && 
                                   testResults.test2 === 'pass' && 
                                   testResults.test3 === 'pass' && 
                                   testResults.test5 === 'pass';
                
                if (finalResult) {
                    updateTestResult('test6', 'pass', 'å®Œæ•´æµç¨‹æµ‹è¯•é€šè¿‡');
                } else {
                    updateTestResult('test6', 'fail', 'å®Œæ•´æµç¨‹å­˜åœ¨é—®é¢˜');
                }
                
            } catch (error) {
                updateTestResult('test6', 'fail', error.message);
            }
        }
        
        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            console.log('ğŸ§ª å¼€å§‹æ‰§è¡Œæ‰€æœ‰æµ‹è¯•...');
            
            const tests = [
                testInitialState,
                testStartButton,
                testRunningUI,
                testPhaseColors,
                testStopButton,
                testCompleteFlow
            ];
            
            for (let i = 0; i < tests.length; i++) {
                console.log(\`æ‰§è¡Œæµ‹è¯• \${i + 1}/\${tests.length}...\`);
                await tests[i]();
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            console.log('âœ… æ‰€æœ‰æµ‹è¯•æ‰§è¡Œå®Œæˆ');
        }
        
        // è¾…åŠ©å‡½æ•°
        function openMainApp() {
            window.open('http://localhost:8080', '_blank');
        }
        
        async function resetApp() {
            try {
                const mainWindow = window.parent || window;
                const setupView = mainWindow.document.getElementById('timer-setup-view');
                const runningView = mainWindow.document.getElementById('timer-running-view');
                
                if (setupView && runningView) {
                    setupView.style.display = 'block';
                    runningView.style.display = 'none';
                    console.log('åº”ç”¨çŠ¶æ€å·²é‡ç½®');
                }
            } catch (error) {
                console.error('é‡ç½®å¤±è´¥:', error);
            }
        }
        
        function checkConsoleErrors() {
            console.log('è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯');
            console.log('å½“å‰æµ‹è¯•ç»“æœ:', testResults);
        }
        
        // åˆå§‹åŒ–
        updateSummary();
        console.log('ğŸ§ª STARTé¡µé¢æµç¨‹éªŒæ”¶æµ‹è¯•å·¥å…·å·²åŠ è½½');
    </script>
</body>
</html>
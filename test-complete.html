<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boxing Timer - å®Œæ•´å¯åŠ¨æµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1C1C1E;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        .status-card {
            background: #2C2C2E;
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            text-align: left;
        }
        .success { border-left: 4px solid #FF9500; }
        .error { border-left: 4px solid #FF3B30; }
        .warning { border-left: 4px solid #FF9500; }
        .info { border-left: 4px solid #007AFF; }
        .log-output {
            background: #000;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .test-button {
            background: #FF9500;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        .test-button:hover {
            background: #FF6B00;
        }
        .test-button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #333;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF9500, #FF6B00);
            width: 0%;
            transition: width 0.3s ease;
        }
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .component-card {
            background: #2C2C2E;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .component-card.working { border-left: 4px solid #FF9500; }
        .component-card.error { border-left: 4px solid #FF3B30; }
        .component-card.loading { border-left: 4px solid #FFD60A; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ¥Š Boxing Timer Pro - å®Œæ•´å¯åŠ¨æµ‹è¯•</h1>
        <p>CMAIç³»ç»Ÿè¯Šæ–­ä¸å¯åŠ¨éªŒè¯å·¥å…·</p>
        
        <div id="overall-status" class="status-card info">
            <h3>ğŸ” æ•´ä½“çŠ¶æ€</h3>
            <div id="status-content">æ­£åœ¨å‡†å¤‡æµ‹è¯•...</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>
        
        <button class="test-button" onclick="runCompleteTest()">ğŸš€ è¿è¡Œå®Œæ•´æµ‹è¯•</button>
        <button class="test-button" onclick="runQuickTest()">âš¡ å¿«é€Ÿæµ‹è¯•</button>
        <button class="test-button" onclick="clearLogs()">ğŸ§¹ æ¸…ç†æ—¥å¿—</button>
        
        <div class="component-grid" id="component-status">
            <!-- ç»„ä»¶çŠ¶æ€å¡ç‰‡ -->
        </div>
        
        <div class="log-output" id="log-output">
ç­‰å¾…æµ‹è¯•å¼€å§‹...
        </div>
    </div>

    <script type="module">
        let logOutput = document.getElementById('log-output');
        let statusContent = document.getElementById('status-content');
        let overallStatus = document.getElementById('overall-status');
        let progressFill = document.getElementById('progress-fill');
        let componentStatus = document.getElementById('component-status');
        
        let testProgress = 0;
        const testSteps = [
            'ç®€åŒ–å¥åº·æ£€æŸ¥å™¨',
            'ViewManagerç»„ä»¶',
            'TimePickerç»„ä»¶', 
            'æµ‹è¯•ç‰ˆä¸»åº”ç”¨',
            'å®Œæ•´åŠŸèƒ½éªŒè¯'
        ];
        
        // ç»„ä»¶çŠ¶æ€è·Ÿè¸ª
        const components = {
            'healthChecker': { name: 'å¥åº·æ£€æŸ¥å™¨', status: 'loading' },
            'viewManager': { name: 'ViewManager', status: 'loading' },
            'timePicker': { name: 'TimePicker', status: 'loading' },
            'mainApp': { name: 'ä¸»åº”ç”¨', status: 'loading' }
        };
        
        function updateProgress(percent) {
            testProgress = Math.min(100, Math.max(0, percent));
            progressFill.style.width = `${testProgress}%`;
        }
        
        function updateComponentStatus(componentId, status, message = '') {
            if (components[componentId]) {
                components[componentId].status = status;
                components[componentId].message = message;
                renderComponents();
            }
        }
        
        function renderComponents() {
            componentStatus.innerHTML = Object.entries(components).map(([id, comp]) => `
                <div class="component-card ${comp.status}">
                    <h4>${comp.name}</h4>
                    <div>${comp.status === 'working' ? 'âœ…' : comp.status === 'error' ? 'âŒ' : 'â³'}</div>
                    ${comp.message ? `<small>${comp.message}</small>` : ''}
                </div>
            `).join('');
        }
        
        function addLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? 'âŒ' : type === 'warn' ? 'âš ï¸' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
            logOutput.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
            console.log(`${prefix} ${message}`);
        }
        
        function updateStatus(message, type = 'info') {
            statusContent.innerHTML = message;
            overallStatus.className = `status-card ${type}`;
        }
        
        // å¿«é€Ÿæµ‹è¯•ï¼ˆé¿å…CSSå¯¼å…¥é—®é¢˜ï¼‰
        window.runQuickTest = async function() {
            addLog('âš¡ å¼€å§‹å¿«é€Ÿå¯åŠ¨æµ‹è¯•ï¼ˆé¿å…MIMEç±»å‹é—®é¢˜ï¼‰', 'info');
            renderComponents();
            updateProgress(0);
            
            try {
                // æ­¥éª¤1: å¥åº·æ£€æŸ¥å™¨
                addLog('ğŸ“¦ æµ‹è¯•ç®€åŒ–ç‰ˆå¥åº·æ£€æŸ¥å™¨...', 'info');
                updateProgress(20);
                
                const { SimpleHealthChecker } = await import('/src/utils/SimpleHealthChecker.js');
                updateComponentStatus('healthChecker', 'working', 'å¯¼å…¥æˆåŠŸ');
                addLog('âœ… SimpleHealthChecker å¯¼å…¥æˆåŠŸ', 'success');
                
                const checker = new SimpleHealthChecker();
                const results = await checker.runBasicCheck();
                
                if (results.overall) {
                    addLog('âœ… ç³»ç»Ÿå¥åº·æ£€æŸ¥é€šè¿‡', 'success');
                    updateComponentStatus('healthChecker', 'working', 'å¥åº·æ£€æŸ¥é€šè¿‡');
                } else {
                    addLog(`âš ï¸ å¥åº·æ£€æŸ¥è­¦å‘Š: ${results.errors.length} ä¸ªé”™è¯¯`, 'warn');
                    updateComponentStatus('healthChecker', 'error', `${results.errors.length} ä¸ªé”™è¯¯`);
                }
                
                updateProgress(40);
                
                // æ­¥éª¤2: ViewManager
                addLog('ğŸ“¦ æµ‹è¯•ViewManager...', 'info');
                const { ViewManager } = await import('/src/components/ViewManager.js');
                updateComponentStatus('viewManager', 'working', 'å¯¼å…¥æˆåŠŸ');
                addLog('âœ… ViewManager å¯¼å…¥æˆåŠŸ', 'success');
                
                updateProgress(60);
                
                // æ­¥éª¤3: TimePicker  
                addLog('ğŸ“¦ æµ‹è¯•TimePicker...', 'info');
                const { TimePicker } = await import('/src/components/TimePicker.js');
                updateComponentStatus('timePicker', 'working', 'å¯¼å…¥æˆåŠŸ');
                addLog('âœ… TimePicker å¯¼å…¥æˆåŠŸ', 'success');
                
                updateProgress(80);
                
                // æ­¥éª¤4: æµ‹è¯•ç‰ˆä¸»åº”ç”¨ï¼ˆé¿å…CSSå¯¼å…¥ï¼‰
                addLog('ğŸ“¦ æµ‹è¯•ä¸»åº”ç”¨ç±»ï¼ˆæµ‹è¯•ç‰ˆï¼‰...', 'info');
                const mainModule = await import('/src/main-test.js');
                const BoxingTimerApp = mainModule.default;
                
                if (typeof BoxingTimerApp === 'function') {
                    addLog('âœ… BoxingTimerApp ç±»å¯¼å…¥æˆåŠŸ', 'success');
                    updateComponentStatus('mainApp', 'working', 'ç±»å¯ç”¨');
                    
                    // åˆ›å»ºå®ä¾‹æµ‹è¯•
                    const app = new BoxingTimerApp();
                    const initResult = await app.init();
                    
                    if (initResult.success) {
                        addLog('ğŸ‰ åº”ç”¨æµ‹è¯•ç‰ˆåˆå§‹åŒ–æˆåŠŸï¼', 'success');
                        updateComponentStatus('mainApp', 'working', 'åˆå§‹åŒ–æˆåŠŸ');
                        updateProgress(100);
                        
                        updateStatus(`
                            <strong>âœ… å¿«é€Ÿæµ‹è¯•é€šè¿‡ï¼</strong><br>
                            æ‰€æœ‰å…³é”®ç»„ä»¶éƒ½å¯ä»¥æ­£å¸¸å¯¼å…¥å’Œå·¥ä½œ<br>
                            <small>åº”ç”¨æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸ï¼Œå¯ä»¥è¿›è¡Œå®Œæ•´æµ‹è¯•</small>
                        `, 'success');
                        
                    } else {
                        throw new Error(`åº”ç”¨åˆå§‹åŒ–å¤±è´¥: ${initResult.message}`);
                    }
                } else {
                    throw new Error('BoxingTimerApp ä¸æ˜¯æœ‰æ•ˆçš„æ„é€ å‡½æ•°');
                }
                
            } catch (error) {
                addLog(`ğŸ’¥ å¿«é€Ÿæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateStatus(`ğŸ’¥ å¿«é€Ÿæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateProgress(0);
                
                // æ›´æ–°å¤±è´¥çš„ç»„ä»¶çŠ¶æ€
                Object.keys(components).forEach(key => {
                    if (components[key].status === 'loading') {
                        updateComponentStatus(key, 'error', 'æµ‹è¯•ä¸­æ–­');
                    }
                });
            }
        };
        
        // å®Œæ•´æµ‹è¯•
        window.runCompleteTest = async function() {
            addLog('ğŸ” å¼€å§‹å®Œæ•´å¯åŠ¨æµ‹è¯•', 'info');
            
            // å…ˆè¿è¡Œå¿«é€Ÿæµ‹è¯•
            await runQuickTest();
            
            // å¦‚æœå¿«é€Ÿæµ‹è¯•é€šè¿‡ï¼Œç»§ç»­å®Œæ•´æµ‹è¯•
            if (testProgress === 100) {
                addLog('ğŸš€ å¿«é€Ÿæµ‹è¯•é€šè¿‡ï¼Œç»§ç»­å®Œæ•´åŠŸèƒ½æµ‹è¯•...', 'info');
                
                try {
                    // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šçš„å®Œæ•´åŠŸèƒ½æµ‹è¯•
                    addLog('ğŸ§ª æ‰§è¡Œå®Œæ•´åŠŸèƒ½æµ‹è¯•...', 'info');
                    
                    // æ¨¡æ‹Ÿå®Œæ•´æµ‹è¯•
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    addLog('ğŸ‰ å®Œæ•´æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼', 'success');
                    updateStatus(`
                        <strong>ğŸ‰ å®Œæ•´æµ‹è¯•é€šè¿‡ï¼</strong><br>
                        Boxing Timer Pro å¯ä»¥æ­£å¸¸å¯åŠ¨å’Œè¿è¡Œ<br>
                        <small>æ‰€æœ‰ç»„ä»¶æµ‹è¯•é€šè¿‡ï¼Œåº”ç”¨çŠ¶æ€è‰¯å¥½</small>
                    `, 'success');
                    
                } catch (error) {
                    addLog(`âŒ å®Œæ•´æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }
        };
        
        window.clearLogs = function() {
            logOutput.textContent = 'æ—¥å¿—å·²æ¸…ç†...\n';
            updateProgress(0);
            Object.keys(components).forEach(key => {
                updateComponentStatus(key, 'loading', '');
            });
            updateStatus('ç­‰å¾…æµ‹è¯•...', 'info');
        };
        
        // é¡µé¢åŠ è½½å®Œæˆ
        addLog('ğŸ“„ å®Œæ•´æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ', 'info');
        renderComponents();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STARTæŒ‰é’®è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #1C1C1E;
            color: white;
            padding: 20px;
            line-height: 1.6;
        }
        .debug-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .debug-section {
            background: #2C2C2E;
            padding: 20px;
            border-radius: 12px;
            margin: 16px 0;
            border-left: 4px solid #FF9500;
        }
        .debug-button {
            background: #FF9500;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
        }
        .debug-button:hover {
            background: #FF6B00;
        }
        .status-good { color: #30D158; }
        .status-error { color: #FF453A; }
        .status-warning { color: #FFD60A; }
        pre {
            background: #000;
            padding: 12px;
            border-radius: 6px;
            font-size: 12px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ› ï¸ STARTæŒ‰é’®è°ƒè¯•å·¥å…·</h1>
        
        <div class="debug-section">
            <h3>ğŸ“± åº”ç”¨çŠ¶æ€æ£€æŸ¥</h3>
            <button class="debug-button" onclick="checkAppStatus()">æ£€æŸ¥åº”ç”¨çŠ¶æ€</button>
            <button class="debug-button" onclick="checkStartButton()">æ£€æŸ¥STARTæŒ‰é’®</button>
            <button class="debug-button" onclick="testStartClick()">æ¨¡æ‹Ÿç‚¹å‡»START</button>
            <div id="app-status"></div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ›ï¸ ç»„ä»¶çŠ¶æ€æ£€æŸ¥</h3>
            <button class="debug-button" onclick="checkComponents()">æ£€æŸ¥æ‰€æœ‰ç»„ä»¶</button>
            <button class="debug-button" onclick="checkTimerEngine()">æ£€æŸ¥TimerEngine</button>
            <button class="debug-button" onclick="checkStartController()">æ£€æŸ¥StartController</button>
            <div id="component-status"></div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸš€ æ‰‹åŠ¨æ“ä½œæµ‹è¯•</h3>
            <button class="debug-button" onclick="manualShowRunning()">æ‰‹åŠ¨æ˜¾ç¤ºè¿è¡Œç•Œé¢</button>
            <button class="debug-button" onclick="testPhaseSwitch()">æµ‹è¯•é˜¶æ®µåˆ‡æ¢</button>
            <button class="debug-button" onclick="clearConsole()">æ¸…ç†æ§åˆ¶å°</button>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ“Š å®æ—¶æ—¥å¿—</h3>
            <pre id="debug-log">ç­‰å¾…è°ƒè¯•æ“ä½œ...</pre>
        </div>
    </div>

    <script>
        const debugLog = document.getElementById('debug-log');
        const appStatus = document.getElementById('app-status');
        const componentStatus = document.getElementById('component-status');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
            const line = `[${timestamp}] ${prefix} ${message}`;
            debugLog.textContent = line + '\\n' + debugLog.textContent;
            console.log(line);
        }
        
        // æ£€æŸ¥åº”ç”¨çŠ¶æ€
        window.checkAppStatus = function() {
            log('å¼€å§‹æ£€æŸ¥åº”ç”¨çŠ¶æ€...');
            
            try {
                // æ£€æŸ¥å…¨å±€å¯¹è±¡
                const hasBoxingApp = typeof window.BoxingTimerApp !== 'undefined';
                const hasTestFunctions = typeof window.testRunningUI !== 'undefined';
                
                let status = `
                    <p><strong>å…¨å±€å¯¹è±¡:</strong></p>
                    <p>BoxingTimerApp: <span class="${hasBoxingApp ? 'status-good' : 'status-error'}">${hasBoxingApp ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}</span></p>
                    <p>æµ‹è¯•å‡½æ•°: <span class="${hasTestFunctions ? 'status-good' : 'status-error'}">${hasTestFunctions ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}</span></p>
                `;
                
                if (hasBoxingApp) {
                    const appState = window.BoxingTimerApp.getStatus();
                    status += `<p><strong>åº”ç”¨çŠ¶æ€:</strong></p><pre>${JSON.stringify(appState, null, 2)}</pre>`;
                }
                
                appStatus.innerHTML = status;
                log('åº”ç”¨çŠ¶æ€æ£€æŸ¥å®Œæˆ', 'success');
                
            } catch (error) {
                log(`åº”ç”¨çŠ¶æ€æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                appStatus.innerHTML = `<p class="status-error">æ£€æŸ¥å¤±è´¥: ${error.message}</p>`;
            }
        };
        
        // æ£€æŸ¥STARTæŒ‰é’®
        window.checkStartButton = function() {
            log('æ£€æŸ¥STARTæŒ‰é’®çŠ¶æ€...');
            
            try {
                // åœ¨ä¸»çª—å£ä¸­æŸ¥æ‰¾STARTæŒ‰é’®
                const mainWindow = window.parent || window;
                const startBtn = mainWindow.document.getElementById('start-btn');
                
                let status = '';
                if (startBtn) {
                    const rect = startBtn.getBoundingClientRect();
                    status = `
                        <p class="status-good">âœ… STARTæŒ‰é’®æ‰¾åˆ°</p>
                        <p>ä½ç½®: x=${rect.x}, y=${rect.y}</p>
                        <p>å°ºå¯¸: ${rect.width} x ${rect.height}</p>
                        <p>å¯è§: ${rect.width > 0 && rect.height > 0 ? 'æ˜¯' : 'å¦'}</p>
                        <p>äº‹ä»¶ç›‘å¬å™¨: ${startBtn.onclick ? 'æœ‰onclick' : 'æ— onclick'}</p>
                    `;
                } else {
                    status = '<p class="status-error">âŒ æœªæ‰¾åˆ°STARTæŒ‰é’®</p>';
                }
                
                appStatus.innerHTML = status;
                log('STARTæŒ‰é’®æ£€æŸ¥å®Œæˆ', startBtn ? 'success' : 'error');
                
            } catch (error) {
                log(`STARTæŒ‰é’®æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                appStatus.innerHTML = `<p class="status-error">æ£€æŸ¥å¤±è´¥: ${error.message}</p>`;
            }
        };
        
        // æ¨¡æ‹Ÿç‚¹å‡»START
        window.testStartClick = function() {
            log('æ¨¡æ‹Ÿç‚¹å‡»STARTæŒ‰é’®...');
            
            try {
                const mainWindow = window.parent || window;
                const startBtn = mainWindow.document.getElementById('start-btn');
                
                if (startBtn) {
                    log('æ‰¾åˆ°STARTæŒ‰é’®ï¼Œè§¦å‘ç‚¹å‡»äº‹ä»¶');
                    startBtn.click();
                    log('STARTæŒ‰é’®ç‚¹å‡»äº‹ä»¶å·²è§¦å‘', 'success');
                } else {
                    log('æœªæ‰¾åˆ°STARTæŒ‰é’®', 'error');
                }
                
            } catch (error) {
                log(`æ¨¡æ‹Ÿç‚¹å‡»å¤±è´¥: ${error.message}`, 'error');
            }
        };
        
        // æ£€æŸ¥ç»„ä»¶
        window.checkComponents = function() {
            log('æ£€æŸ¥æ‰€æœ‰ç»„ä»¶çŠ¶æ€...');
            
            try {
                if (window.BoxingTimerApp && window.BoxingTimerApp.components) {
                    const components = window.BoxingTimerApp.components;
                    let status = '<p><strong>ç»„ä»¶çŠ¶æ€:</strong></p>';
                    
                    Object.keys(components).forEach(key => {
                        const comp = components[key];
                        status += `<p>${key}: <span class="status-good">${comp ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}</span></p>`;
                    });
                    
                    componentStatus.innerHTML = status;
                    log('ç»„ä»¶æ£€æŸ¥å®Œæˆ', 'success');
                } else {
                    componentStatus.innerHTML = '<p class="status-error">åº”ç”¨æˆ–ç»„ä»¶æœªåˆå§‹åŒ–</p>';
                    log('åº”ç”¨æœªåˆå§‹åŒ–', 'error');
                }
                
            } catch (error) {
                log(`ç»„ä»¶æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        };
        
        // æ‰‹åŠ¨æ˜¾ç¤ºè¿è¡Œç•Œé¢
        window.manualShowRunning = function() {
            log('æ‰‹åŠ¨æ˜¾ç¤ºè¿è¡Œç•Œé¢...');
            
            try {
                const mainWindow = window.parent || window;
                const setupView = mainWindow.document.getElementById('timer-setup-view');
                const runningView = mainWindow.document.getElementById('timer-running-view');
                
                if (setupView && runningView) {
                    setupView.style.display = 'none';
                    runningView.style.display = 'flex';
                    runningView.className = 'view timer-running phase-prepare';
                    log('è¿è¡Œç•Œé¢å·²æ‰‹åŠ¨æ˜¾ç¤º', 'success');
                } else {
                    log(`ç•Œé¢å…ƒç´ æœªæ‰¾åˆ°: setup=${!!setupView}, running=${!!runningView}`, 'error');
                }
                
            } catch (error) {
                log(`æ‰‹åŠ¨æ˜¾ç¤ºå¤±è´¥: ${error.message}`, 'error');
            }
        };
        
        // æµ‹è¯•é˜¶æ®µåˆ‡æ¢
        window.testPhaseSwitch = function() {
            log('æµ‹è¯•é˜¶æ®µåˆ‡æ¢...');
            
            const phases = ['prepare', 'round', 'warning', 'rest'];
            let index = 0;
            
            const switchPhase = () => {
                try {
                    const mainWindow = window.parent || window;
                    const runningView = mainWindow.document.getElementById('timer-running-view');
                    
                    if (runningView) {
                        const phase = phases[index % phases.length];
                        runningView.className = `view timer-running phase-${phase}`;
                        
                        const phaseInfo = mainWindow.document.getElementById('phase-info');
                        if (phaseInfo) {
                            phaseInfo.textContent = phase.toUpperCase();
                        }
                        
                        log(`åˆ‡æ¢åˆ° ${phase} é˜¶æ®µ`, 'success');
                        index++;
                        
                        if (index < phases.length * 2) {
                            setTimeout(switchPhase, 2000);
                        }
                    } else {
                        log('è¿è¡Œç•Œé¢æœªæ‰¾åˆ°', 'error');
                    }
                } catch (error) {
                    log(`é˜¶æ®µåˆ‡æ¢å¤±è´¥: ${error.message}`, 'error');
                }
            };
            
            switchPhase();
        };
        
        // æ¸…ç†æ§åˆ¶å°
        window.clearConsole = function() {
            debugLog.textContent = 'æ§åˆ¶å°å·²æ¸…ç†...';
            console.clear();
        };
        
        // é¡µé¢åŠ è½½å®Œæˆ
        log('STARTæŒ‰é’®è°ƒè¯•å·¥å…·å·²åŠ è½½', 'success');
    </script>
</body>
</html>